## 传输层

### TCP 和 UDP 的区别有哪些？

两者都属于传输层协议。

1. TCP 面向连接，UDP 面向无连接
2. TCP 可靠（可靠体现在哪里？），UDP 不可靠
3. TCP 支持点对点通信，UDP 支持一对一、一对多、多对一、多对多通信
4. TCP 面向字节流（把应用层传下来的报文看成字节流，把字节流组织成大小不等的数据块），UDP 面向报文
5. TCP 有拥塞控制，UDP 没有拥塞控制，适合媒体通信
6. TCP 首部开销 20 字节，UDP 首部开销 8 字节

### TCP 如何保证传输的可靠性？

TCP 是面向连接、可靠的字节流服务。

- 面向连接：两个使用 TCP 的应用交换数据之前，必须先建立一个 TCP 连接
- 字节流服务：两个应用程序通过 TCP 连接交换 8 bit 字节构成的字节流

可靠性保证方式：

1. 数据包校验：验证数据在传输过程中的任何变化，若校验出包有错，则丢弃报文段且不给出响应，发送数据端超时后会重新发送数据
2. 失序数据包重排列：TCP 报文段的到达可能会失序，TCP 将失序数据进行重新排列，然后才交给应用层
3. 丢弃重复的数据
4. 应答机制：收到数据后会返回确认 ACK
5. **超时重发**：TCP 发送一个段后，会启动一个定时器，等待目的端确认收到这个报文段，如果不能及时收到一个确认，将重发这个报文段
6. 流量控制：TCP 每一方（发送方和接收方）都有固定大小的缓冲空间，接收端只允许发送端发送接收端缓冲区所能接纳的数据，防止缓冲区溢出（使用的是可变大变小的滑动窗口协议）

### TCP 对应的常见应用层协议有哪些？

- FTP：文件传输协议，端口 `21`
- Telnet
- SMTP
- POP3
- HTTP

### UDP 对应的常见应用层协议有哪些？

- DNS
- SNMP
- TFTP：简单文件传输协议

### TCP 的三次握手

![](/img/network/tcp-3.png)

### TCP 的四次挥手

![](/img/network/tcp-4.jpg)

### 为什么 TCP 需要三次握手，两次不可以吗？为什么？

防止已经失效的连接请求报文到达服务端，产生错误。

报文未丢失，因某些原因滞留在网络节点中，以致延误到连接释放后的某个时间才到达 Server，让 Server 误以为是 Client 发出的新连接请求，导致错误建立连接。

如果不采用三次握手，Server 发出确认就会建立连接；如果采用三次握手，Client 因没有发出请求（并没有申请建立连接）就不会认可 Server 回复的确认。

### TCP 的流量控制和拥塞控制