## XSS 攻击

### 什么是 XSS 攻击？

跨站脚本攻击(Cross Site Scripting)，缩写为 `XSS`。

恶意攻击者往 Web 页面里插入恶意 javaScript 代码，当用户浏览该页之时，嵌入其中 Web 里面的 javaScript 代码会被执行，从而达到恶意攻击用户的目的。

### XSS 的类型有哪些？

- 存储型 XSS（经过后端，经过数据库）：数据库中存有的存在 XSS 攻击的数据，返回给客户端。若数据未经过任何转义。被浏览器渲染。就可能导致 XSS 攻击
- 反射型 XSS（经过后端，不经过数据库，恶意代码存在 URL 里）：将用户输入的存在 XSS 攻击的数据，发送给后台，后台并未对数据进行存储，也未经过任何过滤，直接返回给客户端。被浏览器渲染。就可能导致 XSS 攻击
- DOM 型 XSS（不经过后端）：纯粹发生在客户端的 XSS 攻击

DOM 型 XSS 跟前两种 XSS 的区别：DOM 型 XSS 攻击中，取出和执行恶意代码由浏览器端完成，属于前端 JavaScript 自身的安全漏洞，而其他两种 XSS 都属于服务端的安全漏洞。

### XSS 攻击的危害有哪些？

- 窃取用户 Cookie
- 使用 js 或 css 破坏页面正常的结构与样式
- 流量劫持（通过访问某段具有 `window.location.href` 定位到其他页面）
- Dos攻击：利用合理的客户端请求来占用过多的服务器资源，从而使合法用户无法得到服务器响应
- 利用iframe、frame、XMLHttpRequest 或上述 Flash 等方式，以（被攻击）用户的身份执行一些管理动作，或执行一些一般的如发微博、加好友、发私信等操作
- 利用可被攻击的域受到其他域信任的特点，以受信任来源的身份请求一些平时不允许的操作，如进行不当的投票活动

### 如何防御 XSS 攻击？

XSS 攻击有两大要素：

1. 攻击者提交恶意代码
2. 浏览器执行恶意代码

#### 在输入端过滤

输入侧过滤能够在某些情况下解决特定的 XSS 问题，但会引入很大的不确定性和乱码问题。在防范 XSS 攻击时应避免此类方法。

#### 预防存储型和反射型 XSS 攻击

1. 纯前端渲染
    - 浏览器加载一个静态 HTML，不包含任何业务相关的数据
    - 浏览器执行 HTML 中的 JavaScript
    - JavaScript 通过 Ajax 加载业务数据，调用 DOM API 更新到页面上
2. 转义 HTML

#### 预防 DOM 型 XSS 攻击

DOM 型 XSS 攻击，实际上就是网站前端 JavaScript 代码本身不够严谨，把不可信的数据当作代码执行了。

在使用 `.innerHTML`、`.outerHTML`、`document.write()` 时要特别小心，不要把不可信的数据作为 HTML 插到页面上，而应尽量使用 `.textContent`、`.setAttribute()` 等。

## 参考资料

- [前端安全系列（一）：如何防止XSS攻击？](https://tech.meituan.com/2018/09/27/fe-security.html)
- [如何让前端更安全？——XSS 攻击和防御详解](https://juejin.im/entry/58a598dc570c35006b5cd6b4)

