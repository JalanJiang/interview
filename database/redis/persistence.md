## 持久化

### 为什么需要持久化？

- Redis 是内存数据库，数据库状态都存储在内存里
- 一旦服务器进程退出，服务器中的数据库状态就会消失不见
- 为了保证数据在断电后不会消失，需要将内存中的数据持久化到硬盘上

### 什么是 RDB 持久化？

- RDB 文件是一个经过压缩的二进制文件
- RDB 文件保存在硬盘里
- 通过**保存数据库中的键值对来记录**数据库状态

### RDB 文件的载入时间是？

- 载入工作在服务器启动时自动执行
- 服务器在载入 RDB 文件期间，会一直处于阻塞状态，直到载入工作完成为止

### 什么是 AOF 持久化？

- 通过保存 Redis 服务器所执行的**写命令**来记录数据库状态
- 写入 AOF 文件的所有命令都是以 Redis 的**命令请求协议**格式保存的

### AOF 持久化具体如何实现？

1. 命令追加：若 AOF 持久化功能处于打开状态，服务器在执行完一个命令后，会以协议格式将被执行的写命令追加到服务器状态的 `aof_buf` 缓冲区的末尾
2. 文件写入与同步：
    - 将 `aof_buf` 中的缓存写入到 AOF 文件
    - 将 AOF 文件保存到磁盘中

## 参考资料

- [Redis 持久化](http://jalan.space/2019/02/05/2019/redis-rdb-aof/)