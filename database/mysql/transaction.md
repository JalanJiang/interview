## 事务

### 什么是 ACID？

事务的特性 `ACID` 表示：

- `A`: atomacity 原子性。一个事务必须被视为一个**不可分割**的最小工作单元。整个事务中的所有操作要么全部提交成功，要么全部失败回滚。对于一个事务来说，不可能只执行其中的一部分操作，这就是事务的原子性。
- `C`: consistency 一致性。数据库总是从一个一致性状态转换到另一个一致性的状态。
- `I`: isolation 隔离性。一个事务的影响在该事务提交前对其他事务都不可见。
- `D`: durability 持久性。一旦事务提交，其所做的修改就会永久保存到数据库中。

### 事务有哪些隔离级别？

共有 4 个事务隔离级别：

- 未提交读(Read Uncommitted)

即使一个更新语句没有提交，但是别的事务可以读到这个改变。会产生脏读。

- 提交读(Read Committed)

语句提交以后，即执行了 Commit 以后别的事务就能读到这个改变，只能读取到已经提交的数据。

不允许脏读，但会出现不可重复读。

- 可重复读(Repeatable Read)

同一个事务里面先后执行同一个查询语句的时候，得到的结果是一样的。

不允许脏读，不允许不可重复读，但是会出现幻读。

- 可串行化(Serializable)

事务执行的时候不允许别的事务并发执行。完全串行化的读，每次读都需要获得表级共享锁，读写相互都会阻塞。

#### 名词解释

##### 脏读(Dirty Read)

当一个事务读取另一个事务尚未提交的修改时，产生脏读。

##### 不可重复读(Nonrepeatable Read)

**一个事务**对同一行数据重复读取两次，但是却得到了不同的结果（期间其他提交事务有所操作）。

##### 幻读(Phantom Reads)

事务在操作过程中进行两次查询，第二次查询的结果包含了第一次查询中未出现的数据（这里并不要求两次查询的SQL语句相同）。这是因为在两次查询过程中有另外一个事务插入数据造成的。

当对某行执行插入或删除操作，而该行属于某个事务正在读取的行的范围时，会发生幻像读问题。